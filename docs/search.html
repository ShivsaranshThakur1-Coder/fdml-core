<!doctype html>
<html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>FDML – Search</title>
<link rel="stylesheet" href="style.css?v=@@CSSV@@"/>
</head>
<body>
  <div class="wrap">
    <div class="nav"><a class="cta" href="index.html">← Home</a></div>
    <h1>Search</h1>
    <div class="searchbar" style="display:flex;gap:10px;margin:14px 0 18px">
      <input id="q" type="search" placeholder="Search title, file, or section id…" style="flex:1;padding:10px 12px">
      <button id="clear">Clear</button>
    </div>
    <div id="meta" class="muted" style="margin:8px 0 12px"></div>
    <ul id="results" class="grid"></ul>
  </div>
<script>
(async function(){
  const res = await fetch("index.json");
  const data = await res.json().catch(()=>({items:[]}));
  const items = (data.items||[]).map(it=>({
    file:String(it.file||""), title:String(it.title||"").trim(),
    sections:Array.isArray(it.sections)? it.sections.map(String):[]
  }));
  const Q=document.getElementById("q"), R=document.getElementById("results"), M=document.getElementById("meta");
  document.getElementById("clear").onclick = ()=>{ Q.value=""; render(); Q.focus(); };

  function toHref(file){
    // corpus/valid/example-01.fdml.xml -> cards/example-01.fdml.html
    let base = String(file).replace(/^corpus\/valid\//,"");
    base = base.replace(/\.fdml\.xml$/i, ".fdml.html").replace(/\.xml$/i, ".html");
    return "cards/" + base;
  }
  function match(it,q){
    if(!q) return true; q=q.toLowerCase();
    return it.title.toLowerCase().includes(q) || it.file.toLowerCase().includes(q) ||
           it.sections.some(s=>s.toLowerCase().includes(q));
  }
  function card(it){
    const href = toHref(it.file);
    return `<li><a class="card" href="${href}"><strong>${it.title||href}</strong><div class="sub">${href}</div></a></li>`;
  }
  function render(){
    const q = Q.value.trim();
    const hits = items.filter(it=>match(it,q));
    M.textContent = `${hits.length} of ${items.length} item(s)`;
    R.innerHTML = hits.length ? hits.map(card).join("") : `<li class="card"><div>No matches.</div></li>`;
  }
  Q.addEventListener("input", render); render();
})();
</script>
</body></html>